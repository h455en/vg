<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificateur de voyage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-blue': '#4F46E5',
                        'secondary-gray': '#F9FAFB',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for positioning action buttons */
        .input-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            position: absolute;
            padding: 5px;
            border-radius: 5px;
            transition: background-color 0.2s ease;
            top: 50%;
            transform: translateY(-50%);
        }

        .copy-btn {
            right: 5px;
        }

        .clear-btn {
            right: 35px;
            z-index: 10;
        }

        /* Style adjustments for the textarea clear button */
        .form-group-textarea .clear-btn {
            right: 5px;
            top: 15px;
            /* Adjusting position from the top */
            transform: translateY(0);
        }

        /* Ensure the input has padding for the buttons */
        #startAddress,
        #destinationAddress {
            padding-right: 75px;
            /* Space for both clear (35px) and copy (35px) + margin */
        }

        #otherStops {
            padding-right: 35px;
            /* Space for clear button */
            min-height: 200px;
            resize: vertical;
        }

        /* New style for favorite locations to accommodate the copy button */
        .favorite-location-item {
            position: relative;
            padding-right: 40px;
            /* Space for the copy button */
        }
    </style>
</head>

<body class="bg-gray-50 p-4 sm:p-8 flex justify-center text-gray-700 font-sans min-h-screen">
    <div class="w-full max-w-7xl">
        <header class="flex justify-between items-center p-3 mb-4 bg-white rounded-xl shadow-md border border-gray-200">
            <div id="weatherInfo" class="flex items-center text-sm font-medium text-gray-600">
                <svg class="w-4 h-4 mr-2 text-blue-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                    fill="currentColor">
                    <path
                        d="M19.35 10.04C18.91 7.21 16.59 5 13.75 5c-2.4 0-4.44 1.72-4.91 4.02C5.9 9.69 4 11.81 4 14c0 3.31 2.69 6 6 6h8c2.21 0 4-1.79 4-4 0-2.09-1.54-3.8-3.65-3.96zM17 14c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zm-3 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z" />
                    <circle cx="14" cy="14" r="3" opacity=".3" />
                    <path d="M16 14c0-2.21-1.79-4-4-4s-4 1.79-4 4 1.79 4 4 4 4-1.79 4-4z" opacity=".3" />
                </svg>
                <span class="mr-3">Pluie 40%</span>
                <svg class="w-4 h-4 mr-2 text-indigo-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                    fill="currentColor">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm.8 14.2L11 11.4V7h2v5.19L14.7 14.7l-1.9 1.5z" />
                </svg>
                <span class="mr-3">Dhuhr 12:35</span>
            </div>

            <div id="dateInfo" class="flex items-center text-sm font-medium text-gray-600">
                <svg class="w-4 h-4 mr-2 text-indigo-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                    fill="currentColor">
                    <path
                        d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7zm-2-5v11h14V5H5z" />
                </svg>
                <span>WE 1/2 Nov 2025</span>
            </div>
        </header>

        <div class="flex flex-col gap-8 lg:flex-row lg:items-start max-w-6xl mx-auto">

            <div class="bg-white rounded-xl shadow-2xl p-6 lg:p-8 flex-1">
                <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">Planificateur d'itinéraire</h1>

                <div class="form-group flex items-center gap-3 mb-5">
                    <svg class="w-5 h-5 text-green-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
                    </svg>
                    <div class="input-container w-full relative">
                        <input type="text" id="startAddress" placeholder="Adresse de départ (p. ex., Paris, France)"
                            value="5 rue victor considérant 75014 paris"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150">
                        <button class="input-action-btn clear-btn text-gray-500 hover:bg-gray-100"
                            data-target-id="startAddress">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                            </svg>
                        </button>
                        <button class="input-action-btn copy-btn text-gray-500 hover:bg-gray-100"
                            data-target-id="startAddress">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="form-group flex items-center gap-3 mb-5">
                    <svg class="w-5 h-5 text-red-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
                    </svg>
                    <div class="input-container w-full relative">
                        <input type="text" id="destinationAddress"
                            placeholder="Adresse de destination (p. ex., Rome, Italie)"
                            value="2 place d'aligre 75011 paris"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition duration-150">
                        <button class="input-action-btn clear-btn text-gray-500 hover:bg-gray-100"
                            data-target-id="destinationAddress">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                            </svg>
                        </button>
                        <button class="input-action-btn copy-btn text-gray-500 hover:bg-gray-100"
                            data-target-id="destinationAddress">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="form-group-textarea mb-6">
                    <label for="otherStops" class="block mb-2 text-gray-800 font-medium">Arrêts Intermédiaires (un par
                        ligne)</label>
                    <div class="input-container relative">
                        <textarea id="otherStops" placeholder="p. ex.,
Lyon, France
Genève, Suisse
Milan, Italie" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"></textarea>
                        <button class="input-action-btn clear-btn text-gray-500 hover:bg-gray-100"
                            data-target-id="otherStops">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <button
                    class="btn-generate w-full py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-xl hover:bg-indigo-700 transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50"
                    id="generateBtn">
                    <span id="buttonText">Générer la feuille de route</span>
                </button>

                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-800 mb-3">Emplacements Favoris</h2>
                    <p class="text-xs text-gray-500 mb-3">Cliquez sur le bouton de copie pour utiliser l'adresse dans un
                        champ ci-dessus.</p>
                    <div class="space-y-3">
                        <div class="relative bg-secondary-gray p-3 rounded-lg favorite-location-item flex items-center">
                            <span class="text-sm font-medium text-gray-700 break-words pr-2" id="favAddress1">3 rue
                                bordier 93300 aubervilliers</span>
                            <button class="input-action-btn copy-btn text-gray-500 hover:bg-gray-300"
                                data-target-id="favAddress1">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                                </svg>
                            </button>
                        </div>
                        <div class="relative bg-secondary-gray p-3 rounded-lg favorite-location-item flex items-center">
                            <span class="text-sm font-medium text-gray-700 break-words pr-2" id="favAddress2">12 rue
                                godefroy cavaignac 75011 paris</span>
                            <button class="input-action-btn copy-btn text-gray-500 hover:bg-gray-300"
                                data-target-id="favAddress2">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-secondary-gray rounded-xl shadow-inner p-6 flex-1 lg:sticky lg:top-8 max-h-[85vh] overflow-y-auto"
                id="routePlan" style="display:none;">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">Votre feuille de route</h2>
                <ol id="routeList" class="space-y-4 list-none pl-0">
                </ol>
                <div id="noRouteMessage" class="text-center text-gray-500 mt-4" style="display:none;">
                    L'itinéraire s'affichera ici.
                </div>
            </div>

        </div>
        <footer class="mt-4 p-2 text-center text-gray-500 text-xs flex justify-center items-center gap-2 w-full">
            <svg class="w-4 h-4 text-indigo-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                fill="currentColor">
                <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm.8 14.2L11 11.4V7h2v5.19L14.7 14.7l-1.9 1.5z" />
            </svg>
            <span>Durée d'arrêt min. :</span>
            <input type="number" id="minDuration" value="30"
                class="w-12 text-right p-1 text-sm border border-gray-300 rounded-md">
            <span>min</span>
        </footer>
    </div>

    <div class="message-box fixed top-4 left-1/2 -translate-x-1/2 bg-yellow-300 text-gray-900 px-6 py-3 rounded-lg shadow-xl opacity-0 transition-opacity duration-500 z-50"
        id="messageBox"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const generateBtn = document.getElementById('generateBtn');
            const buttonText = document.getElementById('buttonText');
            const startAddress = document.getElementById('startAddress');
            const destinationAddress = document.getElementById('destinationAddress');
            const otherStops = document.getElementById('otherStops');
            const routePlanSection = document.getElementById('routePlan');
            const routeList = document.getElementById('routeList');
            const messageBox = document.getElementById('messageBox');
            const dateInfo = document.getElementById('dateInfo');
            const weatherInfo = document.getElementById('weatherInfo');
            const allCopyButtons = document.querySelectorAll('.copy-btn');
            const clearButtons = document.querySelectorAll('.clear-btn');
            const monthsAbbr = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            // Nouvelles références pour les adresses favorites
            const favAddress1 = document.getElementById('favAddress1');
            const favAddress2 = document.getElementById('favAddress2');


            const showMessage = (message, type = 'warning') => {
                messageBox.textContent = message;
                messageBox.classList.add('show');

                let bgColor = '';
                let textColor = 'text-gray-900';

                if (type === 'success') {
                    bgColor = 'bg-green-500';
                    textColor = 'text-white';
                } else if (type === 'warning') {
                    bgColor = 'bg-yellow-300';
                } else if (type === 'error') {
                    bgColor = 'bg-red-500';
                    textColor = 'text-white';
                }

                messageBox.className = `message-box fixed top-4 left-1/2 -translate-x-1/2 px-6 py-3 rounded-lg shadow-xl opacity-100 transition-opacity duration-500 z-50 ${bgColor} ${textColor}`;

                setTimeout(() => {
                    messageBox.classList.remove('opacity-100');
                    messageBox.classList.add('opacity-0');
                }, 3000);
            };

            const generateMapsLink = (origin, destination) => {
                const today = new Date();
                const dayOfWeek = today.getDay(); // 0 is Sunday, 6 is Saturday
                const daysUntilSaturday = dayOfWeek === 6 ? 0 : 6 - dayOfWeek;
                const saturday = new Date(today.getFullYear(), today.getMonth(), today.getDate() + daysUntilSaturday);
                saturday.setHours(10, 0, 0, 0); // 10:00 AM
                const departureTimeInSeconds = Math.floor(saturday.getTime() / 1000);

                const sanitizedOrigin = encodeURIComponent(origin.trim());
                const sanitizedDestination = encodeURIComponent(destination.trim());

                // IMPORTANT UPDATE: Changed travelmode=transit to travelmode=driving for road trip planning.
                return `https://www.google.com/maps/dir/${sanitizedOrigin}/${sanitizedDestination}?travelmode=driving&departure_time=${departureTimeInSeconds}`;
            };

            // Fonction de mise à jour de l'en-tête (mise à jour pour correspondre au format demandé)
            const updateHeaderInfo = () => {
                // Météo et Dhuhr (Simulé)
                const weatherText = "Pluie 40% | Dhuhr 12:35";
                const weatherIconSvg = `
                    <svg class="w-4 h-4 mr-2 text-blue-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.35 10.04C18.91 7.21 16.59 5 13.75 5c-2.4 0-4.44 1.72-4.91 4.02C5.9 9.69 4 11.81 4 14c0 3.31 2.69 6 6 6h8c2.21 0 4-1.79 4-4 0-2.09-1.54-3.8-3.65-3.96zM17 14c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zm-3 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z" />
                        <circle cx="14" cy="14" r="3" opacity=".3" />
                        <path d="M16 14c0-2.21-1.79-4-4-4s-4 1.79-4 4 1.79 4 4 4 4-1.79 4-4z" opacity=".3" />
                    </svg>
                    <span class="mr-3">Pluie 40%</span>
                    <svg class="w-4 h-4 mr-2 text-indigo-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm.8 14.2L11 11.4V7h2v5.19L14.7 14.7l-1.9 1.5z" />
                    </svg>
                    <span>Dhuhr 12:35</span>
                `;
                weatherInfo.innerHTML = weatherIconSvg;

                // Date du week-end (Simulé pour correspondre à la demande spécifique)
                const dateIconSvg = `
                    <svg class="w-4 h-4 mr-2 text-indigo-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7zm-2-5v11h14V5H5z"/>
                    </svg>
                `;
                dateInfo.innerHTML = `${dateIconSvg}<span>WE 1/2 Nov 2025</span>`;
            };

            // La fonction fetchWeather est conservée mais n'est pas appelée ici pour utiliser la simulation
            const fetchWeather = async () => { /* ... (Logique fetchWeather non modifiée mais non appelée pour l'exemple) ... */ };


            // Mise à jour de la fonction copyText pour gérer à la fois les inputs (avec .value) et les spans (avec .textContent)
            const copyText = (elementId) => {
                const element = document.getElementById(elementId);
                let textToCopy;

                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    // Pour les champs de formulaire (Start, Destination)
                    textToCopy = element.value;
                    element.select();
                } else {
                    // Pour les emplacements favoris (Span)
                    textToCopy = element.textContent;
                    // Utiliser l'API Navigator Clipboard pour le contenu non-input
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showMessage('Adresse copiée!', 'success');
                    }).catch(err => {
                        // Fallback pour les anciens navigateurs
                        console.error('Erreur de copie:', err);
                        showMessage('Erreur de copie. Veuillez copier manuellement.', 'error');
                    });
                    return; // Sortir après la copie avec l'API Clipboard
                }

                // Fallback pour les inputs (utilisé pour Start/Destination)
                document.execCommand('copy');
                showMessage('Adresse copiée!', 'success');
            };

            const clearText = (elementId) => {
                const element = document.getElementById(elementId);
                element.value = '';
                showMessage('Champ effacé!', 'success');
            };

            // Appel de la fonction de mise à jour de l'en-tête (simulée)
            updateHeaderInfo();
            // fetchWeather(); // Désactivé pour utiliser les données simulées d'en-tête

            // Event listener pour tous les boutons de copie
            allCopyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-target-id');
                    copyText(targetId);
                });
            });

            // Event listener pour tous les boutons d'effacement
            clearButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-target-id');
                    clearText(targetId);
                });
            });

            generateBtn.addEventListener('click', () => {
                const start = startAddress.value.trim();
                const destination = destinationAddress.value.trim();
                const stops = otherStops.value.split('\n').map(stop => stop.trim()).filter(stop => stop !== '');

                if (!start || !destination) {
                    showMessage('Veuillez saisir une adresse de départ et de destination.', 'warning');
                    return;
                }

                // Show loading state
                buttonText.textContent = 'Génération en cours...';
                generateBtn.classList.add('opacity-75', 'cursor-not-allowed');
                generateBtn.disabled = true;


                // Clear previous list
                routeList.innerHTML = '';

                // Build the full route
                const fullRoute = [start, ...stops, destination];

                // Populate the ordered list
                for (let i = 0; i < fullRoute.length - 1; i++) {
                    const legStart = fullRoute[i];
                    const legEnd = fullRoute[i + 1];

                    const li = document.createElement('li');
                    li.className = 'text-sm text-gray-800';

                    // Create the clickable anchor tag for the route
                    const link = document.createElement('a');
                    link.className = 'route-link block p-3 bg-white rounded-lg hover:bg-gray-100 transition-colors shadow-md';
                    link.href = generateMapsLink(legStart, legEnd);
                    link.target = "_blank"; // Open in a new tab

                    // Use flex for better alignment, icon, and text
                    let legContent = '';
                    if (i === 0) {
                        // Première étape (Départ -> 1er arrêt/Destination)
                        legContent += '<span class="font-bold text-green-600">DÉPART: </span>';
                    } else {
                        // Étapes intermédiaires
                        legContent += `<span class="font-medium text-indigo-600">ÉTAPE ${i}: </span>`;
                    }

                    // Ajoute l'adresse de fin si c'est la dernière étape
                    const destinationText = (i === fullRoute.length - 2) ?
                        `<span class="font-bold text-red-600">${legEnd}</span>` :
                        legEnd;


                    legContent += `${legStart} <span class="text-gray-400 font-normal mx-1">→</span> ${destinationText}`;


                    link.innerHTML = legContent;

                    li.appendChild(link);
                    routeList.appendChild(li);
                }

                // Reset button state
                buttonText.textContent = 'Générer la feuille de route';
                generateBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                generateBtn.disabled = false;


                // Show the route plan section
                routePlanSection.style.display = 'block';
                showMessage('Itinéraire généré et prêt!', 'success');
            });
        });
    </script>
</body>

</html>